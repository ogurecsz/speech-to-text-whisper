<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ä–µ—á–∏ —Å Whisper</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <h1>üéôÔ∏è –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ä–µ—á–∏ –Ω–∞ –±–∞–∑–µ Whisper</h1>
    <p>–í—ã–±–µ—Ä–∏—Ç–µ –∞—É–¥–∏–æ—Ñ–∞–π–ª (WAV, MP3 –∏ –¥—Ä.), –∏ –æ–Ω –±—É–¥–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∞–Ω –ø—Ä—è–º–æ –≤ –≤–∞—à–µ–º –±—Ä–∞—É–∑–µ—Ä–µ.</p>

    <input type="file" id="audio-file-input" accept="audio/*">
    <button id="transcribe-button">–†–∞—Å–ø–æ–∑–Ω–∞—Ç—å</button>

    <div class="status-box">
      <p><strong>–°—Ç–∞—Ç—É—Å:</strong> <span id="status">–û–∂–∏–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞...</span></p>
    </div>

    <div class="result-box">
      <h2>–†–µ–∑—É–ª—å—Ç–∞—Ç:</h2>
      <p id="result-text"></p>
    </div>
  </div>

  <!-- –í–º–µ—Å—Ç–æ –≤–Ω–µ—à–Ω–µ–≥–æ script.js –≤–µ—Å—å –∫–æ–¥ –ø–æ–¥–∫–ª—é—á—ë–Ω –∫–∞–∫ –º–æ–¥—É–ª—å -->
  <script type="module">
    import { pipeline } from 'https://cdn.jsdelivr.net/npm/@xenova/transformers@2.17.1';

    const fileInput = document.getElementById('audio-file-input');
    const transcribeButton = document.getElementById('transcribe-button');
    const statusElement = document.getElementById('status');
    const resultTextElement = document.getElementById('result-text');

    let recognizer;

    function updateStatus(text) {
      statusElement.textContent = text;
      console.log(text);
    }

    async function initializeRecognizer() {
      try {
        updateStatus('–ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–∏... (–º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ)');
        recognizer = await pipeline('automatic-speech-recognition', 'Xenova/whisper-tiny');
        updateStatus('–ú–æ–¥–µ–ª—å –∑–∞–≥—Ä—É–∂–µ–Ω–∞. –í—ã–±–µ—Ä–∏—Ç–µ –∞—É–¥–∏–æ—Ñ–∞–π–ª.');
        transcribeButton.disabled = false;
      } catch (error) {
        updateStatus('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –º–æ–¥–µ–ª–∏.');
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞—Ç–µ–ª—è:', error);
      }
    }

    async function transcribeAudio() {
      if (!fileInput.files.length) {
        updateStatus('–û—à–∏–±–∫–∞: —Ñ–∞–π–ª –Ω–µ –≤—ã–±—Ä–∞–Ω.');
        return;
      }
      if (!recognizer) {
        updateStatus('–û—à–∏–±–∫–∞: —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞—Ç–µ–ª—å –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω.');
        return;
      }

      const file = fileInput.files[0];
      const audioUrl = URL.createObjectURL(file);

      try {
        transcribeButton.disabled = true;
        resultTextElement.textContent = '';
        updateStatus(`–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–∞: ${file.name}...`);

        const output = await recognizer(audioUrl, {
          chunk_length_s: 30,
          stride_length_s: 5,
          language: 'russian',
          task: 'transcribe'
        });

        updateStatus('–û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞.');
        resultTextElement.textContent = output.text;
      } catch (error) {
        updateStatus('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –≤–æ –≤—Ä–µ–º—è —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è.');
        console.error(error);
      } finally {
        transcribeButton.disabled = false;
        URL.revokeObjectURL(audioUrl);
      }
    }

    transcribeButton.addEventListener('click', transcribeAudio);
    transcribeButton.disabled = true;
    initializeRecognizer();
  </script>
</body>
</html>
